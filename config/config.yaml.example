# Gamma Scalping Engine MVP - copy to config.yaml and adjust

# Status sink (Phase 1: PostgreSQL). Optional; omit to disable. See docs/DATABASE.md.
# status:
#   sink: "postgres"
#   postgres:
#     host: "127.0.0.1"
#     port: 5432
#     database: "bifrost"
#     user: "bifrost"
#     password: ""   # or PGPASSWORD env

# Phase 2: control via PostgreSQL (daemon_control + daemon_run_status); Web UI at GET /
# Status server runs on monitoring host; daemon on trading host (RE-5). Start daemon only on trading machine: python scripts/run_engine.py
# status_server:
#   port: 8765

# IB connection (env overrides: IB_HOST, IB_PORT, IB_CLIENT_ID)
# When using stable daemon (run_daemon.py): daemon uses client_id; hedge app uses hedge_client_id (or client_id+1).
ib:
  host: "127.0.0.1"
  port: 7497
  client_id: 1          # stable daemon holds this ID
  hedge_client_id: 2     # optional; hedge app (run_hedge_app.py) uses this when started by daemon
  connect_timeout: 60   # seconds; increase for slow/remote connections (default 4)

# Stable daemon (run_daemon.py) on trading machine: IB keepalive + start/stop hedge app on resume/suspend (RE-7: does not assume IB is up; retries and writes ib_connected/ib_client_id)
# daemon:
#   hedge_command: "python scripts/run_hedge_app.py"   # optional; default above
#   heartbeat_interval: 10   # seconds between DB polls (default 10)
#   ib_retry_interval_sec: 30   # seconds between IB connect retries when not connected (default 30)

# Single underlying (MVP: NVDA only)
symbol: "NVDA"

# Greeks (Black-Scholes) — model inputs, not gates
greeks:
  risk_free_rate: 0.05
  volatility: 0.35   # annual; or use_ib_greeks: true when available

# Order
order:
  order_type: "market"   # or "limit"

# Safety gates — pipeline-aligned (strategy → state → intent → guard)
# See docs/CONFIG_SAFETY_TAXONOMY.md
gates:
  strategy:
    structure:
      min_dte: 21
      max_dte: 35
      atm_band_pct: 0.03   # |strike - spot| / spot < 3% for "near ATM"
    earnings:
      blackout_days_before: 3
      blackout_days_after: 1
      dates: []   # e.g. ["2025-02-26", "2025-05-28"]
    trading_hours_only: true
  state:
    delta:
      epsilon_band: 10
      threshold_hedge_shares: 25
      max_delta_limit: 500
    market:
      vol_window_min: 5
      stale_ts_threshold_ms: 5000
    liquidity:
      wide_spread_pct: 0.1
      extreme_spread_pct: 0.5
    system:
      data_lag_threshold_ms: 1000
  intent:
    hedge:
      min_hedge_shares: 10
      cooldown_seconds: 60
      max_hedge_shares_per_order: 500
      min_price_move_pct: 0.2
  guard:
    risk:
      max_daily_hedge_count: 50
      max_position_shares: 2000    # max net stock hedge (long or short)
      max_daily_loss_usd: 5000.0   # circuit breaker: stop hedging if day P&L < -X
      max_net_delta_shares: null   # alert threshold; exceed = force hedge (null = no limit)
      max_spread_pct: null         # pause hedge if bid-ask spread > this % (null = disabled)
      paper_trade: true
